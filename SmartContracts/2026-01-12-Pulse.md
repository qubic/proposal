# Pulse (PULSE)

## Available Options
> Option 0: no, dont allow

> Option 1: yes, allow

## Table of Contents
1. [Introduction](#1-introduction)
2. [Game Mechanics](#2-game-mechanics)
3. [Revenue Distribution](#3-revenue-distribution)
4. [Prize Structure](#4-prize-structure)
5. [Settlement Process](#5-settlement-process)
6. [Security Features](#6-security-features)
7. [Code](#7-code)

---

## 1. Introduction

Pulse is a 6-digit lottery smart contract operating on the Qubic blockchain.
Players select 6 digits from the range [0, 9], and prizes are awarded
based on matches against 6 winning digits drawn each round (duplicates allowed).
The contract enforces a QHeart balance limit (currently 2B QHeart), and any
excess above that cap is transferred to the QHeart wallet.

### Key Features

- **Fixed prize tables** for left-aligned and any-position matches
- **Scheduled draws** with configurable days and UTC draw hour
- **Revenue split** across dev, burn, shareholders, and QHeart wallet
- **Pro-rata payouts** if contract balance is insufficient
- **QHeart balance cap** with excess routed to the QHeart wallet

---

## 2. Game Mechanics

### Number Selection

- Players choose **6 digits** from **[0, 9]**
- Duplicate digits are allowed; out-of-range digits are rejected

### Ticket Purchase

1. Player invokes `BuyTicket` with selected digits
2. Contract validates:
   - Selling is open
   - Digits are in range
   - Tickets are not sold out (max 1,024 per round)
   - Player has QHeart balance for the ticket price
3. Ticket is registered and QHeart is transferred to the contract

### Winning Criteria

For each ticket, the prize is the maximum of:
- **Left-aligned matches:** number of consecutive matches from the start until the first mismatch
- **Any-position matches:** total matches with multiplicity (min count per digit)

---

## 3. Revenue Distribution

Ticket revenue (QHeart asset) is split by the configured fee percentages.
The remainder stays in the contract balance to fund prizes.

**Default fee structure:**

| Recipient | Percentage | Description |
|-----------|------------|-------------|
| Dev Team | 10% | Contract development and maintenance |
| Burn | 5% | Deflationary mechanism |
| Shareholders | 5% | Distributed across PULSE shareholders |
| QHeart Wallet | 5% | Sent to QHeart issuer wallet |
| Remainder | 75% | Retained in contract for prizes |

---

## 4. Prize Structure

### Left-Aligned Reward Table

| Matches | Reward |
|---------|--------|
| 6 | 2000 x ticket price |
| 5 | 300 x ticket price |
| 4 | 60 x ticket price |
| 3 | 20 x ticket price |
| 2 | 4 x ticket price |
| 1 | 1 x ticket price |
| 0 | 0 |

### Any-Position Reward Table

| Matches | Reward |
|---------|--------|
| 6 | 150 x ticket price |
| 5 | 30 x ticket price |
| 4 | 8 x ticket price |
| 3 | 2 x ticket price |
| 2 | 0 |
| 1 | 0 |
| 0 | 0 |

### Payout Rule

For each ticket:
```
prize = max(leftAlignedReward, anyPositionReward)
```

If the contract balance is insufficient to pay all prizes in full,
each prize is scaled proportionally:
```
scaledPrize = floor(prize * availableBalance / totalPrize)
```

---

## 5. Settlement Process

Settlement is triggered by `BEGIN_TICK` when:
1. Current hour >= configured draw hour
2. Scheduled day matches (Wednesday or schedule bit set)
3. Date differs from last draw

### Settlement Steps

1. If no tickets sold, return
2. Compute round revenue (ticketPrice x ticketCounter)
3. Transfer fees (dev, burn, shareholders, QHeart wallet)
4. Generate 6 winning digits (duplicates allowed)
5. Compute total prizes across all tickets
6. Pay prizes:
   - Full payout if balance >= totalPrize
   - Pro-rata scaling if balance < totalPrize
7. If balance exceeds QHeart hold limit, transfer excess to QHeart wallet
8. Clear tickets and close round

---

## 6. Security Features

- **Digit validation**: range checks
- **Selling gates**: disabled during draws and if schedule disallows
- **Ticket cap**: max 1,024 tickets per round
- **Pro-rata safety**: prevents overdraft when balance is insufficient
- **Balance cap**: excess QHeart routed to issuer wallet

---

## 7. Code
[PR](https://github.com/qubic/core/pull/714)

---
